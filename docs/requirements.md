# 画像から献立を提案するWebアプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Recipe Suggester AI

### 1.2 目的
ユーザーが食材の画像をアップロードすることで、AIが画像を解析し、その食材を使った献立を提案するWebアプリケーションを開発する。

### 1.3 対象ユーザー
- 料理のレパートリーを増やしたい一般ユーザー
- 冷蔵庫の食材を有効活用したい主婦・主夫
- 料理初心者で献立に悩む人

## 2. 機能要件

### 2.1 主要機能

#### 2.1.1 画像撮影・アップロード機能
- デバイスのカメラを起動して直接撮影可能
- カメラアプリとの連携（モバイルデバイス）
- 撮影した画像の即時アップロード
- ギャラリーからの画像選択も可能
- 複数画像の同時アップロードに対応
- 対応画像形式: JPEG, PNG, WebP
- 最大ファイルサイズ: 10MB/画像
- ドラッグ&ドロップ対応（デスクトップ版）

#### 2.1.2 画像解析機能
- AIを使用して画像内の食材を自動識別
- 識別された食材のリスト表示
- 識別精度の表示（信頼度スコア）
- 手動での食材追加・削除・編集機能

#### 2.1.3 献立提案機能
- 識別された食材を基に複数の献立を提案
- 各献立に以下の情報を表示：
  - 料理名
  - 調理時間の目安
  - 難易度（初級・中級・上級）
  - カロリー目安
  - 必要な追加食材リスト

#### 2.1.4 レシピ詳細表示機能
- 選択した献立の詳細レシピを表示
- 材料リスト（人数分調整可能）
- 調理手順（ステップバイステップ）
- 調理のコツ・ポイント
- 栄養成分情報
- 必要な調味料チェックリスト

#### 2.1.5 調味料確認・代替レシピ提案機能
- レシピに必要な調味料の一覧表示
- ユーザーが持っている調味料をチェック
- 不足している調味料がある場合の通知
- 代替レシピの自動提案（不足調味料を使わないレシピ）
- 代用可能な調味料の提案
- 近くのスーパーで購入可能な調味料情報（オプション）

#### 2.1.6 献立履歴機能
- 過去に提案された献立の履歴を保存
- お気に入り登録機能
- 履歴の検索・フィルタリング機能

### 2.2 付加機能

#### 2.2.1 ユーザー管理機能
- ユーザー登録・ログイン機能
- プロフィール管理（アレルギー情報、好み等）
- パスワードリセット機能

#### 2.2.2 カスタマイズ機能
- 食事の種類選択（朝食・昼食・夕食・デザート）
- 料理ジャンル選択（和食・洋食・中華・エスニック等）
- 調理時間の制限設定
- アレルギー・食材制限の設定

#### 2.2.3 共有機能
- 献立のSNS共有機能
- レシピのPDF出力機能
- 買い物リストの生成機能

## 3. 非機能要件

### 3.1 パフォーマンス要件
- 画像アップロード: 5秒以内で完了
- 画像解析: 10秒以内で結果表示
- 献立提案: 5秒以内で結果表示
- 同時接続ユーザー数: 100人以上対応

### 3.2 セキュリティ要件
- HTTPS通信の実装
- ユーザー認証（JWT）
- アップロード画像のウイルススキャン
- SQLインジェクション対策
- XSS対策

### 3.3 ユーザビリティ要件
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
- 直感的なUI/UX
- アクセシビリティ対応（WCAG 2.1 Level AA準拠）
- 日本語インターフェース

### 3.4 可用性要件
- 稼働率: 99.5%以上
- バックアップ: 日次自動バックアップ
- エラー発生時の適切なエラーメッセージ表示

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: Next.js 14（App Router）
- **UI コンポーネント**: Shadcn/ui（Radix UI + Tailwind CSS）
- **状態管理**: Jotai
- **フォーム管理**: React Hook Form + Zod
- **画像処理**: Next/Image, react-dropzone
- **カメラ機能**: Web API (MediaDevices API) for camera access

### 4.2 バックエンド
- **API**: Next.js API Routes
- **認証**: NextAuth.js
- **データベース**: PostgreSQL（Supabase）
- **ORM**: Prisma

### 4.3 AI/画像解析
- **画像認識API**: Amazon Rekognition（推奨：AWS S3との統合が容易）
- **献立提案AI**: OpenAI API（GPT-4）

### 4.4 インフラ
- **ホスティング**: Vercel
- **画像ストレージ**: AWS S3
- **CDN**: Vercel Edge Network + CloudFront（S3用）

## 5. 画面構成

### 5.1 主要画面
1. **ホーム画面**
   - ヘッダー（ロゴ、ナビゲーション、ログイン）
   - カメラ起動ボタン（モバイル優先デザイン）
   - 画像アップロードエリア
   - 使い方ガイド
   - フッター

2. **画像解析結果画面**
   - アップロード画像のプレビュー
   - 識別された食材リスト
   - 食材の編集機能
   - 献立生成ボタン

3. **献立提案画面**
   - 提案された献立カード（グリッド表示）
   - フィルター・ソート機能
   - 詳細表示ボタン

4. **レシピ詳細画面**
   - 料理画像
   - 材料リスト
   - 調味料チェックリスト
   - 調理手順
   - 栄養情報
   - お気に入り登録ボタン
   - 「調味料が足りない」ボタン

5. **代替レシピ提案画面**
   - 不足している調味料の表示
   - 代替レシピの一覧
   - 代用可能な調味料の提案
   - 元のレシピに戻るボタン

6. **マイページ**
   - プロフィール情報
   - 献立履歴
   - お気に入りリスト
   - 設定

## 6. データモデル

### 6.1 主要エンティティ
- **User**: ユーザー情報
- **Upload**: アップロード画像情報
- **Ingredient**: 食材マスタ
- **Seasoning**: 調味料マスタ
- **Recipe**: レシピ情報
- **RecipeIngredient**: レシピと食材の関連
- **RecipeSeasoning**: レシピと調味料の関連
- **UserSeasoning**: ユーザーが持っている調味料
- **RecipeHistory**: 献立提案履歴
- **Favorite**: お気に入り

## 7. テスト戦略

### 7.1 テストレベルと範囲

#### 7.1.1 ユニットテスト
- **対象**: 個別の関数、コンポーネント、ユーティリティ
- **ツール**: Jest + React Testing Library
- **カバレッジ目標**: 80%以上
- **重点テスト項目**:
  - 画像バリデーション関数
  - 食材データ処理ロジック
  - レシピフィルタリング機能
  - Jotai atomsの状態管理
  - APIレスポンスの変換処理

#### 7.1.2 統合テスト
- **対象**: API Routes、データベース連携、外部API連携
- **ツール**: Jest + MSW (Mock Service Worker)
- **重点テスト項目**:
  - 画像アップロードフロー全体
  - Amazon Rekognition APIとの連携
  - OpenAI APIとの連携
  - データベースCRUD操作
  - 認証フロー

#### 7.1.3 E2Eテスト
- **対象**: ユーザーシナリオ全体
- **ツール**: Playwright
- **重点シナリオ**:
  - 新規ユーザー登録〜初回利用フロー
  - カメラ撮影〜献立提案フロー
  - 調味料不足〜代替レシピ提案フロー
  - お気に入り登録・履歴確認フロー
  - エラー発生時のリカバリーフロー

#### 7.1.4 ビジュアルリグレッションテスト
- **対象**: UIコンポーネント、画面レイアウト
- **ツール**: Storybook + Chromatic
- **重点項目**:
  - レスポンシブデザイン（モバイル/タブレット/PC）
  - ダークモード対応
  - アクセシビリティ要件

### 7.2 テスト自動化

#### 7.2.1 CI/CDパイプライン
```yaml
# GitHub Actions設定例
- プルリクエスト時:
  - リント実行
  - 型チェック
  - ユニットテスト実行
  - カバレッジレポート生成
  
- マージ時:
  - 統合テスト実行
  - E2Eテスト実行（ステージング環境）
  - ビルド検証
  
- デプロイ前:
  - 全テストスイート実行
  - パフォーマンステスト
  - セキュリティスキャン
```

#### 7.2.2 テストデータ管理
- **Fixtures**: テスト用の固定データセット
- **Factories**: 動的なテストデータ生成
- **Seeders**: データベース初期データ投入

### 7.3 パフォーマンステスト

#### 7.3.1 測定項目
- **画像アップロード**: 5秒以内
- **画像解析**: 10秒以内
- **献立提案**: 5秒以内
- **First Contentful Paint**: 1.8秒以内
- **Time to Interactive**: 3.9秒以内

#### 7.3.2 負荷テスト
- **ツール**: k6 または Artillery
- **シナリオ**:
  - 同時100ユーザーアクセス
  - 1時間で1,000件の画像アップロード
  - ピーク時のAPI呼び出し

### 7.4 セキュリティテスト

#### 7.4.1 脆弱性診断
- **依存関係チェック**: npm audit, Snyk
- **コードスキャン**: SonarQube
- **OWASP Top 10対応確認**

#### 7.4.2 ペネトレーションテスト
- **認証・認可のバイパス試行**
- **SQLインジェクション**
- **XSS攻撃**
- **ファイルアップロード脆弱性**

### 7.5 テスト環境

#### 7.5.1 環境構成
- **開発環境**: ローカル開発用
- **テスト環境**: 自動テスト実行用
- **ステージング環境**: 本番相当の検証用
- **本番環境**: 実運用環境

#### 7.5.2 テストデータ
- **画像サンプル**: 各種食材の画像セット
- **モックAPI**: 外部API応答のモック
- **テストユーザー**: 各種権限のテストアカウント

## 8. 開発スケジュール（目安）

### Phase 1: 基本機能実装（4週間）
- Week 1-2: 環境構築、基本UI実装、テスト環境整備
- Week 3: 画像アップロード・解析機能（テスト含む）
- Week 4: 献立提案機能（テスト含む）

### Phase 2: 拡張機能実装（3週間）
- Week 5: ユーザー管理機能（テスト含む）
- Week 6: 履歴・お気に入り機能、調味料確認機能（テスト含む）
- Week 7: カスタマイズ機能、代替レシピ提案（テスト含む）

### Phase 3: テスト・最終調整（2週間）
- Week 8: 統合テスト、E2Eテスト実装
- Week 9: パフォーマンス最適化、セキュリティ診断、バグ修正、デプロイ

### テスト実装タイミング
- **ユニットテスト**: 各機能実装と同時進行
- **統合テスト**: 各Phase終了時
- **E2Eテスト**: Phase 3で集中実装
- **負荷テスト**: Phase 3で実施

## 9. 制約事項
- 外部APIの利用制限（月間リクエスト数）
- 画像ストレージの容量制限
- AI APIのコスト管理

## 10. 今後の拡張案
- 栄養管理機能（カロリー計算、栄養バランス表示）
- 献立プランナー機能（週間献立作成）
- コミュニティ機能（レシピ投稿・共有）
- 食材の在庫管理機能
- スマートスピーカー連携